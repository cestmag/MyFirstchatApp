<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="">
 
  <link rel="stylesheet" href="/style3.css"> <!-- /public/style ã ã¨ã ã‚-->
  
  <title>thread</title> 
  
  
<script defer src="http://localhost:5000/socket.io/socket.io.js">// user.jsã®ioã®ã‚ã‚‹å ´æ‰€</script>

<script defer src="users.js"></script>


</head>   
<body>
  <header>
   
      <p id="usernamepunk"><span id="usernamepunk2"><%=name%></span><span>ã§ãƒ­ã‚°ã‚¤ãƒ³ä¸­</span></p>
      <div class="chris">
      <h2>ChatApp</h2>
      <!--<a href="/introduce?name=<%=name%>""></a>-->
    <nav>
     
      <ul class="main-nav">
        <li><a href="/thread">Logout</a></li>
        <li><a href="/mypage?name=<%=name%>">Mypage</a></li>
        <!--<li><a href="/mypage/:iii">Mypage</a></li>--> <!--'/mypage?name='+ encodeURIuigig(taro)'-->
        <li><a href="/search?name=<%=name%>">Search</a></li>
       </ul>
      
    </nav>
    </div>
    </header>
  <div id="main-area">
  <div id="message-here"></div>
  <div id="seach-result"></div>
  </div>
  <!--  <form action="/room" method="POST">
  <input name="room" type="text" required>
  <button type="submit">New Room</button>
</form> -->



 <form id="send-new-thread">
    <input type="text" placeholder="Message here" class="thread-box" id="threadbox" name="thread">
    <button type="submit" id="createbtn">Send</button>
    </form>

    
     <script src="jquery.js"></script>
     <script>
  //  let ajaxList = [];
   //   var flou=[];
   //  var thedataofresearch={};
//!!!!!!!!!!!!!! mypageã‹ã‚‰threadã¸è¡Œãã¨ããŸã¾ã«æœªãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã«ãªã‚‹!!!!!!!!!!!!!!é‡å¤§ã‚¨ãƒ©ãƒ¼
     const whatsyourname=document.getElementById("usernamepunk2")
     const name10=whatsyourname.innerText
     console.log(name10+" this the user name10 on ejs")
     //const realname=thisusername

     

  ã€€ã€€/*let ajaxObj=*/$.ajax({
        url: "http://localhost:5000"+ "/get_messages",
        method: "GET",
        success: function(response){
         //  flou=response
          
        // alert("success1:"+response)//ã“ã“ã‚‚å…·ä½“çš„ãªå€¤ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãŒä¸‹ã®å ´åˆã¯[object object]ã¨ãªã‚‹fuck
         //ã“ã“ã¯æˆåŠŸã™ã‚“ã®ã«ä¸‹ã®å ´åˆã¯æˆåŠŸã›ã‚“
          var messages2= document.getElementById('message-here')

          data=JSON.parse(response);
        //  alert("success1 parse:"+data)   
          
        for(var a=0; a< data.length; a++){//ã‚‚ã—è‡ªåˆ†ã¨åŒã˜åå‰ã ã£ãŸã‚‰èƒŒæ™¯ã‹ãˆã‚‹
            var li=document.createElement('div')
            var ident=data[a].id
            li.classList.add("chatboxx")
            li.setAttribute("id","boxx-"+ident)
            //åå‰
            const sendername=document.createElement('p')
            sendername.classList.add("nameofSender") 
            




            if(name10!==data[a].name){
              sendername.innerText=data[a].name
            
           // li.innerHTML=data[a].name+":"+data[a].messageContent2
          
            }else{
              sendername.innerText='You'
             li.classList.add("myOwnmessage")
           // li.innerHTML="You:"+data[a].messageContent2 
            }
            //ã„ã„ã­ã€€ãŠã‚ˆã³è¿”ä¿¡ãƒœã‚¿ãƒ³
            const buttonline=document.createElement('div')

            const goodbutton=document.createElement('button')
            goodbutton.setAttribute("id","good-"+data[a].id)
            goodbutton.classList.add("cestpasmafaute")
            if(data[a].goodname.indexOf("/"+name10+"/")!==-1){//å®Œå…¨ä¸€è‡´ã«ã—ãªã„ã¨ã„ã‘ãªã„!!!!!!!!!!!!!!!!!!!!!
              goodbutton.textContent="â™¥:"+data[a].good//good already pushed
              goodbutton.classList.add("pushedd")
              console.log(data[a].goodname+"nulllll")
            }else{
              goodbutton.textContent="â™¡:"+data[a].good//ğŸ‘ not yet
              console.log(data[a].goodname+"nulllll2")
            }
            /*+ databaseã‹ã‚‰ã„ã„ã­å€¤ã®æ•°ã‚‚èª­ã¿å–ã‚Šã“ã“ã«ä¹—ã£ã‘ã‚‹ãã—ã¦ã€databaseã«ã¯
            threadã«ã„ã„ã­ã—ãŸusernameã‚‚ä¹—ã£ã¦ãŠã‚Šãã‚Œã«ã‚ˆã‚Šã€ã™ã§ã«æŠ¼ã•ã‚ŒãŸã‹å¦ã‹åˆ¤åˆ¥ã—ã€è¡¨ç¤ºã‚’å¤‰ãˆã‚‹
            æœ¬æ¥ã¯å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚½ã‚³ãƒ³å†…ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹ãŒdont know well about how to do that   */
            

            goodbutton.onclick=function goodsend(){
              console.log("you dont knowwwww thread")
              var dutch;
              if (this.textContent.indexOf("â™¥")!==-1){
               dutch=0;
               //this.textContent
              }else{
                dutch=1
              }
                  socket.emit("good",{gla: this.id.slice(5), which:dutch})//idã§ã©ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã«ã„ã„ã­ã•ã‚ŒãŸã‹ç‰¹å®šã—ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡
                  //è¡¨ç¤ºã‚’ã¾ã æŠ¼ã—ã¦ãªã„ã¨ãã¸
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€//if not yetã€€ã€€ã€€ã€€
                
                  //è¡¨ç¤ºã‚’ã™ã§ã«æŠ¼ã—ãŸã¸
            }
            buttonline.append(goodbutton)
           //æ—¥å›³å®¶
            const thetime=document.createElement('p')
            thetime.classList.add("thetime")
            thetime.innerText=data[a].date
            //å†…å®¹
            const thecontent=document.createElement('div')
            thecontent.classList.add("thecontent")
            thecontent.setAttribute("id","cont-"+ident)
            thecontent.innerText=data[a].messageContent2
            //htmlã«ã¯ã“ã®é †ç•ªã§ä¹—ã‚‹
           li.append(sendername) 
            li.append(thecontent)

             li.append(buttonline)
            li.append(thetime)
            
            messages2.append(li)
           
          } 

   




        }
      })   
     // alert("put into ajaxlist: get_message"+ajaxObj)
     // ajaxList.push(ajaxObj);

//let ajaxObj2=[]
 /*   $(function(){//ã‚‚ã†ä¸€ã¤ã®ajaxã¨ã®é–¢ä¿‚ã§ã€ã€€clickã•ã‚Œã‚‹ã€ã“ã“ã®ajaxãŒ
      //console.log($('#searchbox').val()+"last christasf")

      









   $('#search-button').on('click',function(){
     
      
    
       // console.log($('#searchbox').val()+"last christasf")
      /* ajaxObj2= */
   /*   $.ajax({
            url:"http://localhost:5000" + "/search",
           //contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            type: 'GET', //post ã¯ã‚¨ãƒ©ãƒ¼
            data: {query: $('#searchbox').val()},
            dataType: 'json'
            
}     // */
           //é€ã‚‹ãƒ‡ãƒ¼ã‚¿ã®ç¨®é¡no numberã¨ãŠãªã˜ã§ãªã‘ã‚Œã°ã„ã‘ãªã„ã¨ã‹ï¼Ÿ
      /*    ) 
         .done(function(response2){ 
           alert("babafumika "+response2)
           thedataofresearch=response2
           alert("the dateforsearch is"+thedataofresearch)
        thedataofresearch=JSON.stringify(thedataofresearch)
           alert("the stringfied of thenaameofsearch"+thedataofresearch)   */
    //      var searchres=document.getElementById('seach-result') 
         // $('#seach-result').empty()
              //ã“ã“ã¾ã§ã¯ã„ãbut [object object]ã¨ãªã‚‹.fuck
             //kokoã‹ã‚‰ã ã‚ã€€ä¸Šã§ã¯æˆåŠŸã™ã‚‹ã€‚é•ã„ã¯ä½•?????????? success: functionå‹ã‚‚è©¦ã—ãŸbut failed
 /*      var response22=JSON.stringify(response2)
        alert("success2 before pass to when.apply:"+response22)//ã“ã“ãŒ[]ãªã‚‹ã¨ãšã£ã¨èª­ã¿è¾¼ã¿ä¸­ã«ãªã‚‹
        console.log(response22+" æ¤œç´¢æ±ºkã•")
          search=JSON.parse(response22||"null")         
          alert("success2 parsed(before apply)"+search)//ã“ã“ãŒnullã§ãªã„ã¨ãšã£ã¨èª­ã¿è¾¼ã¿ä¸­
          */
         // var data= JSON.parse( JSON.stringify(response2)||"null")
           // $('#seach-result').empty()
  /*
            //var messages222= document.getElementById('seach-result')
            console.log('do they know its christams?')
           
            var html_response = '<ul>';
              $.each(data, function(key, value){
                html_response += '<li>' + value + '</li>';
            });
            html_response += '</ul>';
            $('seach-result').html(html_response)   */
            
   // /*

      //     var data= JSON.parse(response2||"null"); // +||"null"
   // /*
   
     /*     for(var a=0; a< data.length; a++){//ã‚‚ã—è‡ªåˆ†ã¨åŒã˜åå‰ã ã£ãŸã‚‰èƒŒæ™¯ã‹ãˆã‚‹
            var li=document.createElement('div')
            li.classList.add("chatboxx")
            //åå‰
            const sendername=document.createElement('p')
            sendername.classList.add("nameofSender") 
            

            if(name10!==data[a].name){
              sendername.innerText=data[a].name
            
           // li.innerHTML=data[a].name+":"+data[a].messageContent2
          
            }else{
              sendername.innerText='You'
             li.classList.add("myOwnmessage")
           // li.innerHTML="You:"+data[a].messageContent2 
            }
           //æ—¥å›³å®¶
            const thetime=document.createElement('p')
            thetime.classList.add("thetime")
            thetime.innerText=data[a].date
            //å†…å®¹
            const thecontent=document.createElement('div')
            thecontent.classList.add("thecontent")
            thecontent.innerText=data[a].messageContent2
            alert("NOW IN THE FORLOOP"+thecontent.innerText+" "+thetime.innerText)
            //htmlã«ã¯ã“ã®é †ç•ªã§ä¹—ã‚‹
           li.append(sendername) 
            li.append(thecontent)
            li.append(thetime)
            //seach-result
            searchres.append(li)
            console.log(document.getElementById('seach-result'))
           
            alert("SMALL END")
          }  */
         
             // */
       /*   })   
        .fail(function(XMLHttpRequest, textStatus, errorThrown){
    console.log("XMLHttpRequest.status: "+XMLHttpRequest.status);
    console.log("textStatus:"+textStatus);
    console.log("errorThrown:"+errorThrown);
    alert("idiot")
})
/*
.always(function(){
  alert("fuuuuuuuuuuuuuuk")
})     */
     //    console.log('gonna put into ajaxlist'+ajaxList) 

   //   }
  //    ) 
// alert("ONCLICK END")

  // }) 
  // console.log('gonna put into ajaxlist: search:   '+ajaxList) 
   //alert("ajaxobj of serach is: "+ajaxObj2)
//ajaxList.push(ajaxObj2);  












/* ã¯ãšã™
   $.when.apply($, ajaxList)
   .done(function(){
    alert("success1-1 when.apply:"+data)
    const messages2=document.getElementById('message-here')
    
   // alert("success1:"+response)//ã“ã“ã‚‚å…·ä½“çš„ãªå€¤ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãŒä¸‹ã®å ´åˆã¯[object object]ã¨ãªã‚‹fuck
         //ã“ã“ã¯æˆåŠŸã™ã‚“ã®ã«ä¸‹ã®å ´åˆã¯æˆåŠŸã›ã‚“
          

       var data=JSON.parse(flou);
          alert("success1 parse:"+data)


    for(var a=0; a< data.length; a++){//ã‚‚ã—è‡ªåˆ†ã¨åŒã˜åå‰ã ã£ãŸã‚‰èƒŒæ™¯ã‹ãˆã‚‹
            var li=document.createElement('div')
            li.classList.add("chatboxx")
            //åå‰
            const sendername=document.createElement('p')
            sendername.classList.add("nameofSender") 
            

            if(name10!==data[a].name){
              sendername.innerText=data[a].name
            
           // li.innerHTML=data[a].name+":"+data[a].messageContent2
          
            }else{
              sendername.innerText='You'
             li.classList.add("myOwnmessage")
           // li.innerHTML="You:"+data[a].messageContent2 
            }
           //æ—¥å›³å®¶
            const thetime=document.createElement('p')
            thetime.classList.add("thetime")
            thetime.innerText=data[a].date
            //å†…å®¹
            const thecontent=document.createElement('div')
            thecontent.classList.add("thecontent")
            thecontent.innerText=data[a].messageContent2
            //htmlã«ã¯ã“ã®é †ç•ªã§ä¹—ã‚‹
           li.append(sendername) 
            li.append(thecontent)
            li.append(thetime)
            
            messages2.append(li)
         
          }
           data=[];
          


           var response22=JSON.stringify(thedataofresearch)
        alert("success2 before pass to when.apply:"+response22)//ã“ã“ãŒ[]ãªã‚‹ã¨ãšã£ã¨èª­ã¿è¾¼ã¿ä¸­ã«ãªã‚‹
        console.log(response22+" æ¤œç´¢æ±ºkã•")
        var search=JSON.parse(response22||"null")
          alert("success2 parsed"+search)






          const message222=document.getElementById('seach-result')
          alert("search[] is when.apply:"+search)
          for(var a=0; a< search.length; a++){//ã‚‚ã—è‡ªåˆ†ã¨åŒã˜åå‰ã ã£ãŸã‚‰èƒŒæ™¯ã‹ãˆã‚‹
            var li=document.createElement('div')
            li.classList.add("chatboxx")
            //åå‰
            const sendername=document.createElement('p')
            sendername.classList.add("nameofSender") 
            

            if(name10!==search[a].name){
              sendername.innerText=search[a].name
            
           // li.innerHTML=data[a].name+":"+data[a].messageContent2
          
            }else{
              sendername.innerText='You'
             li.classList.add("myOwnmessage")
           // li.innerHTML="You:"+data[a].messageContent2 
            }
           //æ—¥å›³å®¶
            const thetime=document.createElement('p')
            thetime.classList.add("thetime")
            thetime.innerText=search[a].date
            //å†…å®¹
            const thecontent=document.createElement('div')
            thecontent.classList.add("thecontent")
            thecontent.innerText=search[a].messageContent2
            alert("search: content: Is "+thecontent.innerText)
            //htmlã«ã¯ã“ã®é †ç•ªã§ä¹—ã‚‹
           li.append(sendername) 
            li.append(thecontent)
            li.append(thetime)
            
            message222.append(li)
           alert("hey brother2")
          }
       search=[];


    // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã™ã¹ã¦ã®çµæœãŒæˆåŠŸã ã£ãŸå ´åˆã®å‡¦ç†
   console.log('success'+ajaxList.length)
  alert("ajaxlist0: "+ajaxList[0])
  alert("ajaxlist1: "+ajaxList[1]) 

   ajaxList=[]
   console.log('success:after'+ajaxList.length)
}).fail(function(){
    // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã„ãšã‚Œã‹ã®çµæœãŒå¤±æ•—ã ã£ãŸå ´åˆã®å‡¦ç†
    console.log('fail')
});
 














  // ajaxList.push(ajaxObj);
   /*   success: function(response2){
              var messages222= document.getElementById('seach-result')
                 //seach-result
              var data= JSON.parse(response2);
              for(var a=0; a< data.length; a++){//ã‚‚ã—è‡ªåˆ†ã¨åŒã˜åå‰ã ã£ãŸã‚‰èƒŒæ™¯ã‹ãˆã‚‹
            var li=document.createElement('div')
            li.classList.add("chatboxx")
            //åå‰
            const sendername=document.createElement('p')
            sendername.classList.add("nameofSender") 
            

            if(name10!==data[a].name){
              sendername.innerText=data[a].name
            
           // li.innerHTML=data[a].name+":"+data[a].messageContent2
          
            }else{
              sendername.innerText='You'
             li.classList.add("myOwnmessage")
           // li.innerHTML="You:"+data[a].messageContent2 
            }
           //æ—¥å›³å®¶
            const thetime=document.createElement('p')
            thetime.classList.add("thetime")
            thetime.innerText=data[a].date
            //å†…å®¹
            const thecontent=document.createElement('div')
            thecontent.classList.add("thecontent")
            thecontent.innerText=data[a].messageContent2
            //htmlã«ã¯ã“ã®é †ç•ªã§ä¹—ã‚‹
           li.append(sendername) 
            li.append(thecontent)
            li.append(thetime)
            //seach-result
            messages222.append(li)
          }
            }
          })  */

  </script>
</body>



</html>



